<%- include('../header') %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Calendar</h2>
  <div class="d-flex gap-2 align-items-center">
    <a href="<%= base %>/calendar?month=<%= prevMonth %>" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-chevron-left"></i>
    </a>
    <strong><%= monthName %></strong>
    <a href="<%= base %>/calendar?month=<%= nextMonth %>" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-chevron-right"></i>
    </a>
  </div>
</div>

<div class="mb-3">
  <small class="me-3"><span class="badge bg-primary">&nbsp;</span> Orders</small>
  <small class="me-3"><span class="badge bg-success">&nbsp;</span> Subscriptions</small>
  <small class="me-3"><span class="badge" style="background:#6f42c1;">&nbsp;</span> Reservations</small>
  <small><span class="badge bg-warning">&nbsp;</span> Drops</small>
</div>

<div class="table-responsive">
  <table class="table table-bordered text-center" style="table-layout: fixed;">
    <thead class="table-light">
      <tr>
        <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
      </tr>
    </thead>
    <tbody>
      <%
        const startDow = firstDay.getDay();
        const totalDays = lastDay.getDate();
        let day = 1;
        const weeks = Math.ceil((startDow + totalDays) / 7);
      %>
      <% for (let w = 0; w < weeks; w++) { %>
        <tr>
          <% for (let d = 0; d < 7; d++) { %>
            <% const cellNum = w * 7 + d; %>
            <% if (cellNum < startDow || day > totalDays) { %>
              <td class="text-muted" style="height: 80px;"></td>
            <% } else { %>
              <%
                const key = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dd = data[key] || { orders: 0, subscriptions: 0, reservations: 0, drops: 0 };
                const isToday = key === today;
              %>
              <td style="height: 80px; vertical-align: top; cursor: pointer;<%= isToday ? 'background: #fff3cd;' : '' %>"
                  onclick="window.location='<%= base %>/calendar/day/<%= key %>'">
                <div class="fw-bold<%= isToday ? ' text-warning' : '' %>"><%= day %></div>
                <div class="mt-1">
                  <% if (dd.orders) { %><span class="badge bg-primary rounded-pill" title="<%= dd.orders %> orders"><%= dd.orders %></span> <% } %>
                  <% if (dd.subscriptions) { %><span class="badge bg-success rounded-pill" title="<%= dd.subscriptions %> deliveries"><%= dd.subscriptions %></span> <% } %>
                  <% if (dd.reservations) { %><span class="badge rounded-pill" style="background:#6f42c1;" title="<%= dd.reservations %> reservations"><%= dd.reservations %></span> <% } %>
                  <% if (dd.drops) { %><span class="badge bg-warning rounded-pill" title="<%= dd.drops %> drops"><%= dd.drops %></span> <% } %>
                </div>
              </td>
              <% day++; %>
            <% } %>
          <% } %>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

<%- include('../footer') %>
