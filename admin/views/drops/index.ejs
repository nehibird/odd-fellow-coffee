<%- include('../header') %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Drops</h2>
  <a href="/drops/new" class="btn btn-dark btn-sm">
    <i class="bi bi-plus-lg me-1"></i> New Drop
  </a>
</div>

<% if (drops.length === 0) { %>
  <p class="text-muted">No drops yet.</p>
<% } else { %>
  <% drops.forEach(drop => { %>
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <strong><%= drop.title %></strong>
          <span class="ms-2"><%- helpers.statusBadge(drop.status) %></span>
        </div>
        <div class="text-muted"><%= helpers.formatDate(drop.drop_date) %></div>
      </div>
      <div class="card-body">
        <div class="row mb-2">
          <div class="col-auto"><small class="text-muted">Opens: <%= helpers.formatDateTime(drop.opens_at) %></small></div>
          <% if (drop.closes_at) { %>
            <div class="col-auto"><small class="text-muted">Closes: <%= helpers.formatDateTime(drop.closes_at) %></small></div>
          <% } %>
          <% if (drop.pickup_start) { %>
            <div class="col-auto"><small class="text-muted">Pickup: <%= helpers.formatDateTime(drop.pickup_start) %> - <%= helpers.formatDateTime(drop.pickup_end) %></small></div>
          <% } %>
        </div>

        <% if (drop.items && drop.items.length > 0) { %>
          <table class="table table-sm mb-2">
            <thead>
              <tr>
                <th>Product</th>
                <th>Sold</th>
                <th>Available</th>
                <th>Price Override</th>
              </tr>
            </thead>
            <tbody>
              <% drop.items.forEach(item => { %>
                <tr>
                  <td><%= item.product_name %></td>
                  <td><%= item.quantity_sold %></td>
                  <td><%= item.quantity_available %></td>
                  <td><%= item.price_cents_override ? helpers.formatCents(item.price_cents_override) : '-' %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        <% } %>

        <% if (drop.status !== 'closed') { %>
          <form method="POST" action="/drops/<%= drop.id %>/close" class="d-inline" data-confirm="Close this drop? This cannot be undone.">
            <button class="btn btn-sm btn-outline-danger">Close Drop</button>
          </form>
        <% } %>
      </div>
    </div>
  <% }); %>
<% } %>

<%- include('../footer') %>
